<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-left">
      <div class="logo">
        <img src="assets/logo/snapedit_1758626403883-removebg-preview.png" alt="ERGODRIVE Logo" class="logo-img">
      </div>
    </div>
    <div class="header-center">
      <h1 class="welcome-title">Waktu Reaksi Rem</h1>
      <p class="welcome-subtitle">
        Analisis kecepatan reaksi pengereman dan faktor-faktor yang
        mempengaruhinya
      </p>
    </div>
    <div class="header-right">
      <div class="action-buttons">
        <ion-button (click)="startBrakeTest()" fill="solid" size="small">
          <ion-icon name="play"></ion-icon>
          Mulai Tes
        </ion-button>
        <ion-button (click)="refreshData()" fill="clear" size="small">
          <ion-icon name="refresh"></ion-icon>
        </ion-button>
        <ion-button (click)="exportData()" fill="clear" size="small">
          <ion-icon name="download"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <!-- Current Performance -->
    <div class="current-performance">
      <div class="performance-card">
        <div class="performance-header">
          <h2>Performa Saat Ini</h2>
          <div
            class="performance-status"
            [style.color]="getReactionTimeColor(statistics.averageReactionTime)"
          >
            {{ statistics.averageReactionTime <= 0.8 ? 'Sempurna' :
            statistics.averageReactionTime <= 1.2 ? 'Baik' :
            statistics.averageReactionTime <= 1.8 ? 'Cukup' : 'Perlu Perbaikan'
            }}
          </div>
        </div>
        <div class="performance-content">
          <div class="performance-metric">
            <div
              class="metric-value"
              [style.color]="getReactionTimeColor(statistics.averageReactionTime)"
            >
              {{ statistics.averageReactionTime }}s
            </div>
            <div class="metric-label">Waktu Reaksi Rata-rata</div>
          </div>
          <div class="performance-metric">
            <div class="metric-value">{{ statistics.bestReactionTime }}s</div>
            <div class="metric-label">Waktu Terbaik</div>
          </div>
          <div class="performance-metric">
            <div class="metric-value">{{ statistics.accuracyRate }}%</div>
            <div class="metric-label">Akurasi</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Overview -->
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="speedometer"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.totalTests }}</div>
          <div class="stat-label">Total Tes</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="trending-up"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">+{{ statistics.improvementRate }}%</div>
          <div class="stat-label">Peningkatan</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="checkmark-circle"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.accuracyRate }}%</div>
          <div class="stat-label">Akurasi Reaksi</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="time"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.testDuration }}</div>
          <div class="stat-label">Durasi Tes</div>
        </div>
      </div>
    </div>

    <!-- Speed Analysis -->
    <div class="speed-analysis-section">
      <h2 class="section-title">Analisis Berdasarkan Kecepatan</h2>
      <div class="speed-analysis-grid">
        <div class="speed-card" *ngFor="let speed of speedAnalysis">
          <div class="speed-header">
            <div class="speed-value">{{ speed.speed }}</div>
            <div
              class="safety-indicator"
              [style.background]="getSafetyColor(speed.safetyLevel)"
            >
              {{ getSafetyLevel(speed.safetyLevel) }}
            </div>
          </div>
          <div class="speed-metrics">
            <div class="speed-metric">
              <span class="metric-label">Reaksi:</span>
              <span
                class="metric-value"
                [style.color]="getReactionTimeColor(speed.reactionTime)"
              >
                {{ speed.reactionTime }}s
              </span>
            </div>
            <div class="speed-metric">
              <span class="metric-label">Jarak Rem:</span>
              <span class="metric-value">{{ speed.brakingDistance }}m</span>
            </div>
            <div class="speed-metric">
              <span class="metric-label">Total:</span>
              <span class="metric-value">{{ speed.totalDistance }}m</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <h2 class="section-title">Analisis Reaksi Rem</h2>
      <div class="charts-grid">
        <!-- Waktu Reaksi Rata-rata Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">
              {{ chartData.waktuReaksiRataRata.title }}
            </h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div
                  class="bar-item"
                  *ngFor="let data of chartData.waktuReaksiRataRata.data"
                >
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div
                      class="bar-fill"
                      [style.width.%]="data.percentage"
                      [style.background]="getReactionTimeColor(data.value)"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}s</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Jarak Pengereman Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.jarakPengereman.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div
                  class="bar-item"
                  *ngFor="let data of chartData.jarakPengereman.data"
                >
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div
                      class="bar-fill"
                      [style.width.%]="data.percentage"
                      [style.background]="getBarColor(data.percentage)"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}m</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Akurasi Reaksi Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.akurasiReaksi.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div
                  class="bar-item"
                  *ngFor="let data of chartData.akurasiReaksi.data"
                >
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div
                      class="bar-fill"
                      [style.width.%]="data.percentage"
                      [style.background]="getBarColor(data.value)"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}%</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tekanan Rem Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.tekananRem.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div
                  class="bar-item"
                  *ngFor="let data of chartData.tekananRem.data"
                >
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div
                      class="bar-fill"
                      [style.width.%]="data.percentage"
                      [style.background]="getBarColor(data.value)"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}%</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reaction Factors -->
    <div class="factors-section">
      <h2 class="section-title">Faktor yang Mempengaruhi Waktu Reaksi</h2>
      <div class="factors-grid">
        <div class="factor-card" *ngFor="let factor of reactionFactors">
          <div class="factor-icon">
            <ion-icon
              [name]="factor.icon"
              [style.color]="factor.color"
            ></ion-icon>
          </div>
          <div class="factor-content">
            <h3>{{ factor.factor }}</h3>
            <div class="factor-impact" [style.color]="factor.color">
              {{ factor.impact }}
            </div>
            <p>{{ factor.description }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Tests -->
    <div class="recent-tests-section">
      <h2 class="section-title">Tes Terbaru</h2>
      <div class="recent-tests-list">
        <div class="test-item" *ngFor="let test of recentTests">
          <div
            class="test-status"
            [style.background]="getStatusColor(test.status)"
          ></div>
          <div class="test-details">
            <div class="test-time">{{ test.time }}</div>
            <div class="test-metrics">
              <div class="test-metric">
                <span>Reaksi: {{ test.reactionTime }}s</span>
              </div>
              <div class="test-metric">
                <span>Kecepatan: {{ test.speed }} km/j</span>
              </div>
              <div class="test-metric">
                <span>Jarak: {{ test.distance }}m</span>
              </div>
              <div class="test-metric">
                <span>Akurasi: {{ test.accuracy }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Safety Recommendations -->
    <div class="recommendations-section">
      <h2 class="section-title">Rekomendasi Keselamatan</h2>
      <div class="recommendations-grid">
        <div
          class="recommendation-card"
          *ngFor="let rec of safetyRecommendations"
        >
          <div class="recommendation-icon">
            <ion-icon
              [name]="rec.icon"
              [style.color]="getPriorityColor(rec.priority)"
            ></ion-icon>
          </div>
          <div class="recommendation-content">
            <h3>{{ rec.title }}</h3>
            <p>{{ rec.description }}</p>
          </div>
          <div class="recommendation-priority">
            <span
              class="priority-badge"
              [style.background]="getPriorityColor(rec.priority)"
            >
              {{ rec.priority === 'high' ? 'Tinggi' : rec.priority === 'medium'
              ? 'Sedang' : 'Rendah' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Trends -->
    <div class="trends-section">
      <h2 class="section-title">Tren Performa Mingguan</h2>
      <div class="trends-card">
        <div class="trends-chart">
          <div class="chart-title">Waktu Reaksi Rem</div>
          <div class="chart-subtitle">Skor rata-rata harian</div>
          <div class="grid-lines">
            <div class="grid-line" style="bottom: 0%;" data-value="60%"></div>
            <div class="grid-line" style="bottom: 25%;" data-value="67.5%"></div>
            <div class="grid-line" style="bottom: 50%;" data-value="75%"></div>
            <div class="grid-line" style="bottom: 75%;" data-value="82.5%"></div>
            <div class="grid-line" style="bottom: 100%;" data-value="90%"></div>
          </div>
          <div class="trend-bars">
            <div class="trend-bar" *ngFor="let trend of weeklyPerformanceData; let i = index">
              <div class="trend-day">{{ trend.day }}</div>
              <div class="trend-bar-wrapper">
                <div class="trend-bar-fill" 
                     [style.height.%]="((trend.value - 60) / 30) * 100"
                     [class.highest]="trend.value === getHighestValue()"></div>
              </div>
              <div class="trend-value">{{ trend.score }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
