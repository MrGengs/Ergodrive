<div class="dashboard-container">
  <!-- Header -->
  <app-shared-header 
    [pageTitle]="'Beban Kerja (Kemudi)'"
    [pageSubtitle]="'Analisis performa mengemudi dan beban kerja pengemudi'">
    <div class="action-buttons" slot="actions">
      <ion-button (click)="refreshData()" fill="clear" size="small">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="exportData()" fill="clear" size="small">
        <ion-icon name="download-outline"></ion-icon>
      </ion-button>
    </div>
  </app-shared-header>

  <div class="dashboard-content">
    <!-- Statistics Overview -->
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="speedometer-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.totalTests }}</div>
          <div class="stat-label">Total Tes</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="analytics-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.averageScore }}%</div>
          <div class="stat-label">Skor Rata-rata</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="trending-up-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">+{{ statistics.improvementRate }}%</div>
          <div class="stat-label">Peningkatan</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="time-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.testDuration }}</div>
          <div class="stat-label">Durasi Tes</div>
        </div>
      </div>
    </div>

    <!-- Detailed Analysis -->
    <div class="detailed-analysis">
      <h2 class="section-title">Analisis Detail</h2>
      <div class="analysis-grid">
        <div class="analysis-card">
          <div class="analysis-header">
            <h3>Waktu Reaksi</h3>
            <span class="analysis-value">{{ detailedAnalysis.reactionTime.current }} {{ detailedAnalysis.reactionTime.unit }}</span>
          </div>
          <div class="analysis-details">
            <div class="analysis-item">
              <span>Rata-rata:</span>
              <span>{{ detailedAnalysis.reactionTime.average }} {{ detailedAnalysis.reactionTime.unit }}</span>
            </div>
            <div class="analysis-item">
              <span>Peningkatan:</span>
              <span [class]="detailedAnalysis.reactionTime.improvement < 0 ? 'improvement' : 'decline'">
                {{ detailedAnalysis.reactionTime.improvement > 0 ? '+' : '' }}{{ detailedAnalysis.reactionTime.improvement }} {{ detailedAnalysis.reactionTime.unit }}
              </span>
            </div>
          </div>
        </div>

        <div class="analysis-card">
          <div class="analysis-header">
            <h3>Akurasi</h3>
            <span class="analysis-value">{{ detailedAnalysis.accuracy.current }}%</span>
          </div>
          <div class="analysis-details">
            <div class="analysis-item">
              <span>Rata-rata:</span>
              <span>{{ detailedAnalysis.accuracy.average }}%</span>
            </div>
            <div class="analysis-item">
              <span>Peningkatan:</span>
              <span [class]="detailedAnalysis.accuracy.improvement > 0 ? 'improvement' : 'decline'">
                +{{ detailedAnalysis.accuracy.improvement }}%
              </span>
            </div>
          </div>
        </div>

        <div class="analysis-card">
          <div class="analysis-header">
            <h3>Tingkat Kelelahan</h3>
            <span class="analysis-value">{{ detailedAnalysis.fatigueLevel.current }}%</span>
          </div>
          <div class="analysis-details">
            <div class="analysis-item">
              <span>Rata-rata:</span>
              <span>{{ detailedAnalysis.fatigueLevel.average }}%</span>
            </div>
            <div class="analysis-item">
              <span>Peningkatan:</span>
              <span [class]="detailedAnalysis.fatigueLevel.improvement < 0 ? 'improvement' : 'decline'">
                {{ detailedAnalysis.fatigueLevel.improvement > 0 ? '+' : '' }}{{ detailedAnalysis.fatigueLevel.improvement }}%
              </span>
            </div>
          </div>
        </div>

        <div class="analysis-card">
          <div class="analysis-header">
            <h3>Tingkat Fokus</h3>
            <span class="analysis-value">{{ detailedAnalysis.focusLevel.current }}%</span>
          </div>
          <div class="analysis-details">
            <div class="analysis-item">
              <span>Rata-rata:</span>
              <span>{{ detailedAnalysis.focusLevel.average }}%</span>
            </div>
            <div class="analysis-item">
              <span>Peningkatan:</span>
              <span [class]="detailedAnalysis.focusLevel.improvement > 0 ? 'improvement' : 'decline'">
                +{{ detailedAnalysis.focusLevel.improvement }}%
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <h2 class="section-title">Grafik Performa</h2>
      <div class="charts-grid">
        <!-- Kecepatan Rata-rata Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.kecepatanRataRata.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.kecepatanRataRata.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                      [style.background]="getBarColor(data.value)"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SDLP Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.sdlp.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.sdlp.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                      [style.background]="getBarColor(data.value)"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Waktu Reaksi PDT Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.waktuReaksiPDT.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.waktuReaksiPDT.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                      [style.background]="getBarColor(data.value, 'reaction')"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- PDT Gagal Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.pdtGagal.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.pdtGagal.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                      [style.background]="getBarColor(data.value, 'failure')"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Trends -->
    <div class="trends-section">
      <h2 class="section-title">Tren Performa Mingguan</h2>
      <div class="trends-card">
        <div class="trends-chart">
          <div class="chart-title">Performa Mengemudi</div>
          <div class="chart-subtitle">Skor rata-rata harian</div>
          <div class="grid-lines">
            <div class="grid-line" style="bottom: 0%;" data-value="60%"></div>
            <div class="grid-line" style="bottom: 25%;" data-value="67.5%"></div>
            <div class="grid-line" style="bottom: 50%;" data-value="75%"></div>
            <div class="grid-line" style="bottom: 75%;" data-value="82.5%"></div>
            <div class="grid-line" style="bottom: 100%;" data-value="90%"></div>
          </div>
          <div class="trend-bars">
            <div class="trend-bar" *ngFor="let trend of weeklyPerformanceData; let i = index">
              <div class="trend-day">{{ trend.day }}</div>
              <div class="trend-bar-wrapper">
                <div class="trend-bar-fill" 
                     [style.height.%]="((trend.value - 60) / 30) * 100"
                     [class.highest]="trend.value === getHighestValue()"></div>
              </div>
              <div class="trend-value">{{ trend.score }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recommendations -->
    <div class="recommendations-section">
      <h2 class="section-title">Rekomendasi</h2>
      <div class="recommendations-grid">
        <div class="recommendation-card">
          <div class="recommendation-icon">
            <ion-icon name="bed-outline"></ion-icon>
          </div>
          <div class="recommendation-content">
            <h4>Istirahat Cukup</h4>
            <p>Disarankan untuk beristirahat minimal 7-8 jam sebelum melakukan tes.</p>
          </div>
        </div>
        <div class="recommendation-card">
          <div class="recommendation-icon">
            <ion-icon name="water-outline"></ion-icon>
          </div>
          <div class="recommendation-content">
            <h4>Hidrasi</h4>
            <p>Minum air putih yang cukup untuk menjaga konsentrasi.</p>
          </div>
        </div>
        <div class="recommendation-card">
          <div class="recommendation-icon">
            <ion-icon name="fitness-outline"></ion-icon>
          </div>
          <div class="recommendation-content">
            <h4>Olahraga Ringan</h4>
            <p>Lakukan peregangan sebelum tes untuk mengurangi kekakuan otot.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activities -->
    <div class="activities-section">
      <h2 class="section-title">Aktivitas Terkini</h2>
      <div class="activities-grid">
        <div class="activity-card">
          <div class="activity-header">
            <div class="activity-icon">
              <ion-icon name="car-outline"></ion-icon>
            </div>
            <div class="activity-info">
              <h4 class="activity-title">Tes Beban Kerja Kemudi</h4>
              <p class="activity-time">2 jam yang lalu</p>
            </div>
            <div class="activity-status completed">Selesai</div>
          </div>
          <div class="activity-details">
            <p>Skor: 92% | Durasi: 15 menit</p>
          </div>
        </div>
        <div class="activity-card">
          <div class="activity-header">
            <div class="activity-icon">
              <ion-icon name="analytics-outline"></ion-icon>
            </div>
            <div class="activity-info">
              <h4 class="activity-title">Analisis Performa</h4>
              <p class="activity-time">4 jam yang lalu</p>
            </div>
            <div class="activity-status success">Optimal</div>
          </div>
          <div class="activity-details">
            <p>Peningkatan: +8.7% dari rata-rata</p>
          </div>
        </div>
        <div class="activity-card">
          <div class="activity-header">
            <div class="activity-icon">
              <ion-icon name="alert-outline"></ion-icon>
            </div>
            <div class="activity-info">
              <h4 class="activity-title">Peringatan Kelelahan</h4>
              <p class="activity-time">6 jam yang lalu</p>
            </div>
            <div class="activity-status warning">Peringatan</div>
          </div>
          <div class="activity-details">
            <p>Tingkat kelelahan: 35% (di atas rata-rata)</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
